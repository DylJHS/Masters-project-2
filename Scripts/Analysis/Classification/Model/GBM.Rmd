---
title: "gbm model"
format: html
editor: visual
Notes: This script is intended to do initialise the building of the gbm ml model using the input and ouput data.
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Users/Dyll/Documents/Education/VU_UVA/Internship/Epigenetics/Janssen_Group-UMCUtrecht/Main_Project")
```

## Load the libraries

## Load the libraries

```{r}
library(dplyr)
library(mltools)
library(knitr)
library(factoextra)
library(data.table)
library(ggpubr)
library(psych)
```

Re-usable functions

```{r}
extract_element <- function(strings, index) {
  # Split each string by "." and extract the third element
  element_list <- sapply(strsplit(strings, "\\."), function(x) x[index])
  return(element_list)
}

untransform_exp <- function(x) {#Function to convert the log transformed counts back into original counts
  return(ceiling((2^x)-1))
}

transform_exp <- function(x) {#Function to convert the log transformed counts back into original counts
  return(log2(x + 1))
}

untransform_tpm <- function(x) {#Function to convert the log transformed counts back into original counts
  return(ceiling((2^x)-0.001))
}

transform_tpm <- function(x) {#Function to convert the log transformed counts back into original counts
  return(log2(x + 0.001))
}
```

Import data

```{r}

# SOI genes
soi <- read.csv("Data/RNA_Data/TCGA_TPM/TCGA_mRNA_TPM_SOI.csv")
soi_genes <-soi[,2]

# Predictor variables

# Expected Counts
ori_exp <- read.csv("Data/RNA_Data/TCGA_Norm/tcga_gene_expected_count.csv")
order_exp <- ori_exp[,order(colnames(ori_exp))]
order_exp <- order_exp[0:6000,0:2500]

# TPM counts
ori_tpm <- read.csv("Data/RNA_Data/TCGA_TPM/TCGA_mRNA_TPM_Full.csv")
order_tpm <- ori_tpm[,order(colnames(ori_tpm))] %>% 
  dplyr::select(-"id")
order_tpm <- order_tpm[0:6000,0:2500]



# Response data
ori_hrd <- read_tsv("Data/CIN_Features/TCGA.HRD_withSampleID.txt")
ori_arm_cnv <- read_tsv("Data/CIN_Features/CNV_Data/PANCAN_ArmCallsAndAneuploidyScore_092817.txt")

# Metadata
tss_meta <- read.csv("Data/Other/TCGA_meta/tissueSourceSite.tsv", sep = "\t")
abbrv_meta <- read.csv("Data/Other/TCGA_meta/bcrBatchCode.tsv", sep = "\t")

# Combine the metadata
meta <- left_join(tss_meta %>% 
                     dplyr::select(c("TSS.Code", "Study.Name")) %>% 
                     distinct() %>% 
                     sapply(trimws) %>% 
                     as.data.frame(),
                   abbrv_meta %>%
                     dplyr::select(c("Study.Abbreviation", "Study.Name")) %>% 
                     distinct()%>% 
                     sapply(trimws) %>% 
                     as.data.frame(), 
                   by = "Study.Name")
```