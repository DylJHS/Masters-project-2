panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
RNA_sets_ttest = t.test(data$Mean_set, data$Mean_cntrl, paired = TRUE)
RNA_sets_ttest_pval <- RNA_sets_ttest$p.value
reshaped <- gather(data[,c("Mean_set","Mean_cntrl")], key = "Variable", value = "Value")
ggplot(reshaped, aes( y = Value, x = Variable, fill = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of the Mean Copy Number in the Set-of-Interest vs the Control-Set",
y = "Log2 Expression") +
scale_x_discrete(label = c("Control Set", "Set of Interest")) +
scale_fill_hue(labels = c("Control Set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
geom_text(aes(x = .8,
y = max(Value) - 0.02*max(Value),
label = paste(c("Paired t-test <<", RNA_sets_ttest_pval), collapse = " ")),
stat = "unique")
ggplot(order_data, aes(x = Sample, y = Mean_diff, fill = TSS)) +
geom_col() +
theme_minimal() +
labs(y = "Δ Mean Log2 Expression",
x = "Samples",
title = "Expression Differential by Sample ")+
scale_y_continuous(breaks = c(0, 1, 2, 3))+
theme(
axis.text.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.y = element_text(size = 11),
axis.title.x = element_text(size = 14),
legend.position = "right",
legend.text = element_text(size= 11),
legend.title =element_text(hjust = 0.5,
size = 13),
plot.title = element_text(hjust = 0.4,
size = 18),
plot.title.position = "plot",
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.5, linetype = 2),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_line(size = 0.35, linetype = "solid",
colour = "black"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 1)) +
guides(fill = guide_legend(ncol = 1,
title = "Source Tissue Type",
title.position = "top"))
ggplot(order_data, aes(x = Sample, y = Mean_diff, fill = Hist_group)) +
geom_col() +
theme_minimal() +
labs(y = "Δ Mean Log2 Expression",
x = "Samples",
title = "Expression Differential by Sample ")+
scale_y_continuous(breaks = c(0, 1, 2, 3))+
theme(
axis.text.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.y = element_text(size = 11),
axis.title.x = element_text(size = 14),
legend.position = "right",
legend.text = element_text(size= 11),
legend.title =element_text(hjust = 0.5,
size = 13),
plot.title = element_text(hjust = 0.4,
size = 18),
plot.title.position = "plot",
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.5, linetype = 2),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_line(size = 0.35, linetype = "solid",
colour = "black"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 1)) +
guides(fill = guide_legend(ncol = 1,
title = "Histology Grouping",
title.position = "top"))
perform_mean_test <- function(data) {
test_result <- t.test(data$Mean_set, data$Mean_cntrl, paired = TRUE)
return(data.frame(mean_diff = mean(data$Mean_set - data$Mean_cntrl),
p_value = test_result$p.value))
}
mean_results <- data %>%
group_by(TSS, Hist_group) %>%
filter(n() > 1 & !is.na(Mean_set) & !is.na(Mean_cntrl)) %>%
do(perform_mean_test(.))
results_mean <- mean_results %>%
mutate(p_adjusted = p.adjust(p_value, method = "BH"))
min_nonzero_p <- min(results_mean$p_adjusted[results_mean$p_adjusted > 0])
results_mean$p_value_adjusted <- ifelse(results_mean$p_adjusted == 0, min_nonzero_p, results_mean$p_adjusted)
results_mean$neg_log_pvalue <- -log10(results_mean$p_value_adjusted)
results_mean_complete <- results_mean %>% arrange(Hist_group)
unique_tss <- unique(results_mean_complete$TSS)
results_mean_complete$TSS <- factor(results_mean_complete$TSS, levels = unique_tss)
threshold <- -log10(0.01)
ggplot(results_mean_complete, aes(x = mean_diff, y = neg_log_pvalue, fill = TSS)) +
geom_point(size = 5, shape = 21, stroke = 1) +
geom_hline(yintercept = threshold, linetype = "dashed", color = "red") +
geom_text(aes(x = 2.9, y = threshold, label = "0.01 Threshold"), vjust = -0.5, hjust = -1.5, color = "red") +
theme_minimal() +
coord_cartesian(xlim = c(2.15, 3.2)) +
labs(title = "Comparative Analysis of Average Differential Expression in Set-of-Interest vs Control Set",
x = "Average Differential Log2 Expression",
y = "Adjusted P-Value (-log10)") +
theme(legend.position = "bottom",
legend.text = element_text(size= 9),
axis.title = element_text(size = 14),
legend.title =element_text(hjust = 0.5,
size = 10),
plot.title = element_text(hjust = 0.5,
size = 16),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
scale_color_discrete(name = "Histology Group")
data_complete <- data %>% arrange(Hist_group)
unique_Abbrvs <- unique(data_complete$TSS_Abbrvs)
data_complete$TSS_Abbrvs <- factor(data_complete$TSS_Abbrvs, levels = unique_Abbrvs)
ggplot(data_complete, aes(x = TSS_Abbrvs, y = Mean_set, fill = Hist_group)) +
geom_boxplot() +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Average Gene-set Expression by Source Tissue Type",
y = "Log2 Expression",
fill = "Histology Group") +
theme(legend.position = "right",
legend.text = element_text(size= 7),
axis.text.x = element_text(angle= 90,
size= 8),
axis.title.x = element_blank(),
legend.title =element_text(hjust = 0.5,
size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
ggplot(data_complete, aes(x = Mean_set, fill = TSS_Abbrvs)) +
geom_histogram(alpha = 0.3, position = "identity") +
theme_minimal() +
labs(title = "Histogram of Gene-set Expression by Source Tissue Type",
y = "Log2 Expression",
fill = "TSS") +
theme(legend.position = "right",
legend.text = element_text(size= 7),
axis.text.x = element_text(size= 8),
legend.title =element_text(hjust = 0.5,
size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
library(dplyr)
library(data.table)
library(ggplot2)
library(ggpubr)
library(rstatix)
library(paletteer)
library(PairedData)
setwd("/Users/Dyll/Documents/Education/VU_UVA/Internship/Epigenetics/Janssen_Group-UMCUtrecht/Main_Project")
data <- fread("../../../Data/RNA_Data/Full_RNA_Sample_metrics.csv")
data[, ':=' ('Mean_diff' = Mean_set - Mean_cntrl, 'Median_diff' = Median_set - Median_cntrl)]
order_data <- setDF(data) %>%
arrange( Mean_diff) %>%
mutate(Sample = factor(Sample, levels = unique(Sample)))
ggplot(data, aes(x = Mean_diff)) +
geom_histogram(aes(y = ..density..),
colour = 1,
fill = "white",
bins = 50) +
geom_density(lwd = 1,
colour = 1) +
labs(y = "Density", x = "Δ Log2 Expression",
title = "Distribution of the Set-of-Interest to Control Set \n Differential Log2 Expression Across Samples") +
theme(
axis.title = element_text(size = 13, color = "black", face = "bold"),
axis.text = element_text(color = "black", size = 10),
panel.background = element_rect(fill = "#EDEDED"),
plot.title = element_text(hjust = 0.6, size = 15),
panel.border = element_rect(fill = "transparent", color = 1, linewidth = 1),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 1),
panel.grid.major.x = element_line(color = "black", linewidth = 0.25, linetype = 1),
panel.grid.minor.x = element_line(color = "black", linewidth = 0.1, linetype = 1),
panel.grid.minor.y = element_line(color = "black", linewidth = 0.1, linetype = 1),
plot.title.position = "plot"
)
ggplot(data, aes(sample= Mean_diff)) +
stat_qq() +
stat_qq_line(color= "red") +
labs(title = "Normal QQ Plot for Analysis of the Average Set-of-Interest to \n Control Set Differential Mean Expression in Cancer Samples",
y = "Sample Quantiles",
x = "Theoretical Quantiles") +
theme(
axis.text.x = element_text(size= 8),
axis.title.x = element_text(size= 13),
axis.title.y = element_text(size= 13),
legend.title =element_text(hjust = 0.5,
size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)
)
ggplot(data, aes( y = Mean_set, x = "")) +
geom_boxplot(fill = "white",
outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Set-of-Interest to Control Set Copy Mean Expression \n Differential in Cancer Samples - Boxplot Analysis",
y = "Δ Log2 Expression") +
theme(
axis.text.x = element_text(angle= 90,
size= 8),
axis.title.y = element_text(size= 13),
axis.title.x = element_blank(),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
RNA_sets_ttest = t.test(data$Mean_set, data$Mean_cntrl, paired = TRUE)
RNA_sets_ttest_pval <- RNA_sets_ttest$p.value
reshaped <- gather(data[,c("Mean_set","Mean_cntrl")], key = "Variable", value = "Value")
ggplot(reshaped, aes( y = Value, x = Variable, fill = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of the Mean Copy Number in the Set-of-Interest vs the Control-Set",
y = "Log2 Expression") +
scale_x_discrete(label = c("Control Set", "Set of Interest")) +
scale_fill_hue(labels = c("Control Set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
geom_text(aes(x = .8,
y = max(Value) - 0.02*max(Value),
label = paste(c("Paired t-test <<", RNA_sets_ttest_pval), collapse = " ")),
stat = "unique")
ggplot(order_data, aes(x = Sample, y = Mean_diff, fill = TSS)) +
geom_col() +
theme_minimal() +
labs(y = "Δ Mean Log2 Expression",
x = "Samples",
title = "Expression Differential by Sample ")+
scale_y_continuous(breaks = c(0, 1, 2, 3))+
theme(
axis.text.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.y = element_text(size = 11),
axis.title.x = element_text(size = 14),
legend.position = "right",
legend.text = element_text(size= 11),
legend.title =element_text(hjust = 0.5,
size = 13),
plot.title = element_text(hjust = 0.4,
size = 18),
plot.title.position = "plot",
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.5, linetype = 2),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_line(size = 0.35, linetype = "solid",
colour = "black"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 1)) +
guides(fill = guide_legend(ncol = 1,
title = "Source Tissue Type",
title.position = "top"))
ggplot(order_data, aes(x = Sample, y = Mean_diff, fill = Hist_group)) +
geom_col() +
theme_minimal() +
labs(y = "Δ Mean Log2 Expression",
x = "Samples",
title = "Expression Differential by Sample ")+
scale_y_continuous(breaks = c(0, 1, 2, 3))+
theme(
axis.text.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.y = element_text(size = 11),
axis.title.x = element_text(size = 14),
legend.position = "right",
legend.text = element_text(size= 11),
legend.title =element_text(hjust = 0.5,
size = 13),
plot.title = element_text(hjust = 0.4,
size = 18),
plot.title.position = "plot",
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", size = 0.5, linetype = 2),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_line(size = 0.35, linetype = "solid",
colour = "black"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 1)) +
guides(fill = guide_legend(ncol = 1,
title = "Histology Grouping",
title.position = "top"))
perform_mean_test <- function(data) {
test_result <- t.test(data$Mean_set, data$Mean_cntrl, paired = TRUE)
return(data.frame(mean_diff = mean(data$Mean_set - data$Mean_cntrl),
p_value = test_result$p.value))
}
mean_results <- data %>%
group_by(TSS, Hist_group) %>%
filter(n() > 1 & !is.na(Mean_set) & !is.na(Mean_cntrl)) %>%
do(perform_mean_test(.))
results_mean <- mean_results %>%
mutate(p_adjusted = p.adjust(p_value, method = "BH"))
min_nonzero_p <- min(results_mean$p_adjusted[results_mean$p_adjusted > 0])
results_mean$p_value_adjusted <- ifelse(results_mean$p_adjusted == 0, min_nonzero_p, results_mean$p_adjusted)
results_mean$neg_log_pvalue <- -log10(results_mean$p_value_adjusted)
results_mean_complete <- results_mean %>% arrange(Hist_group)
unique_tss <- unique(results_mean_complete$TSS)
results_mean_complete$TSS <- factor(results_mean_complete$TSS, levels = unique_tss)
threshold <- -log10(0.01)
ggplot(results_mean_complete, aes(x = mean_diff, y = neg_log_pvalue, fill = TSS)) +
geom_point(size = 5, shape = 21, stroke = 1) +
geom_hline(yintercept = threshold, linetype = "dashed", color = "red") +
geom_text(aes(x = 2.9, y = threshold, label = "0.01 Threshold"), vjust = -0.5, hjust = -1.5, color = "red") +
theme_minimal() +
coord_cartesian(xlim = c(2.15, 3.2)) +
labs(title = "Comparative Analysis of Average Differential Expression in Set-of-Interest vs Control Set",
x = "Average Differential Log2 Expression",
y = "Adjusted P-Value (-log10)") +
theme(legend.position = "bottom",
legend.text = element_text(size= 9),
axis.title = element_text(size = 14),
legend.title =element_text(hjust = 0.5,
size = 10),
plot.title = element_text(hjust = 0.5,
size = 16),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
scale_color_discrete(name = "Histology Group")
data_complete <- data %>% arrange(Hist_group)
unique_Abbrvs <- unique(data_complete$TSS_Abbrvs)
data_complete$TSS_Abbrvs <- factor(data_complete$TSS_Abbrvs, levels = unique_Abbrvs)
ggplot(data_complete, aes(x = TSS_Abbrvs, y = Mean_set, fill = Hist_group)) +
geom_boxplot() +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Average Gene-set Expression by Source Tissue Type",
y = "Log2 Expression",
fill = "Histology Group") +
theme(legend.position = "right",
legend.text = element_text(size= 7),
axis.text.x = element_text(angle= 90,
size= 8),
axis.title.x = element_blank(),
legend.title =element_text(hjust = 0.5,
size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
ggplot(data_complete, aes(x = Mean_set, fill = TSS_Abbrvs)) +
geom_histogram(alpha = 0.3, position = "identity") +
theme_minimal() +
labs(title = "Histogram of Gene-set Expression by Source Tissue Type",
y = "Log2 Expression",
fill = "TSS") +
theme(legend.position = "right",
legend.text = element_text(size= 7),
axis.text.x = element_text(size= 8),
legend.title =element_text(hjust = 0.5,
size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
ggplot(results_mean_complete, aes(x = mean_diff, y = neg_log_pvalue, fill = TSS)) +
geom_point(size = 5, shape = 21, stroke = 1) +
geom_hline(yintercept = threshold, linetype = "dashed", color = "red") +
geom_text(aes(x = 2.9, y = threshold, label = ""), vjust = -0.5, hjust = -1.5, color = "red") +
theme_minimal() +
coord_cartesian(xlim = c(2.15, 3.2)) +
labs(title = "Comparative Analysis of Average Differential Expression in Set-of-Interest vs Control Set",
x = "Average Differential Log2 Expression",
y = "Adjusted P-Value (-log10)") +
theme(legend.position = "bottom",
legend.text = element_text(size= 9),
axis.title = element_text(size = 14),
legend.title =element_text(hjust = 0.5,
size = 10),
plot.title = element_text(hjust = 0.5,
size = 16),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
scale_color_discrete(name = "Histology Group")
gr<-ggplot(results_mean_complete, aes(x = mean_diff, y = neg_log_pvalue, fill = TSS)) +
geom_point(size = 5, shape = 21, stroke = 1) +
geom_hline(yintercept = threshold, linetype = "dashed", color = "red") +
geom_text(aes(x = 2.9, y = threshold, label = ""), vjust = -0.5, hjust = -1.5, color = "red") +
theme_minimal() +
coord_cartesian(xlim = c(2.15, 3.2)) +
labs(title = "Comparative Analysis of Average Differential Expression in Set-of-Interest vs Control Set",
x = "Average Differential Log2 Expression",
y = "Adjusted P-Value (-log10)") +
theme(legend.position = "bottom",
legend.text = element_text(size= 9),
axis.title = element_text(size = 14),
legend.title =element_text(hjust = 0.5,
size = 10),
plot.title = element_text(hjust = 0.5,
size = 16),
panel.grid.major = element_line(color = "black",
linewidth = 0.5,
linetype = 1),
panel.grid.minor = element_line(color = "black",
linewidth = 0.2,
linetype = 1),
panel.background = element_rect(fill = "#EDEDED"),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2)) +
scale_color_discrete(name = "Histology Group")
gr
