plot.title = element_text(hjust = 0.6, size = 15),
plot.title.position = "plot",
axis.title = element_text(size = 13, color = "black", face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
legend.text = element_blank(),
legend.position = "none",
panel.border = element_rect(fill = "transparent", color = 1, linewidth = 1),
panel.grid.major.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.minor.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.background = element_rect(fill = "white")
)
graph_long_data <- used_first %>%
dplyr::select(starts_with("Mean_diff")) %>%
pivot_longer(cols = everything(),
names_to = "Variable",
values_to = "Value")
ggplot(graph_long_data, aes(y = Value, x = Variable)) +
geom_boxplot(varwidth = T, alpha  = 0.25, outlier.colour = "red")+
coord_cartesian(ylim = c(-0.25, 0.40)) +
scale_y_continuous() +
labs(x = "Unique SoI / Control Pairings ", y = "Δ Log2 Copy Number",
title = "Distribution of the Set-of-Interest to Control gene-set \n Copy Number Difference Across All Pairings") +
theme(
plot.title = element_text(hjust = 0.6, size = 15),
plot.title.position = "plot",
axis.title = element_text(size = 13, color = "black", face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
legend.text = element_blank(),
legend.position = "none",
panel.border = element_rect(fill = "transparent", color = 1, linewidth = 1),
panel.grid.major.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.minor.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.background = element_rect(fill = "white")
)
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of the Mean Expression in the \n Set-of-Interest vs various Control-Sets",
y = "Log2 Expression") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "Log2 CN") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
knitr::opts_knit$set(root.dir = "/Users/Dyll/Documents/Education/VU_UVA/Internship/Epigenetics/Janssen_Group-UMCUtrecht/Main_Project")
library(dplyr)
library(broom)
library(knitr)
library(coin)
library(data.table)
library(ggpubr)
library(rstatix)
# library(ggplot2)
# library(paletteer)
# library(PairedData)
library(tidyverse)
library(jmuOutlier)
library(paletteer)
# options(scipen = 1, digits = 20)
getOption("max.print")
random_rows <- sample(1:10845, 1000)
first <- fread("Data/CNV_Data/Full_CNV_metrics1.csv")
used_first <- first[random_rows,c("Sample", "Mean_set", "Mean_cntrl","TSS","Hist_group", "TSS_Abbrvs")]
setnames(used_first, old = "Mean_cntrl", new = "Mean_cntrl1")
used_first[, Mean_diff1 := (Mean_set - Mean_cntrl1)]
num_datasets <- 412
# Loop over the datasets
for (i in 2:num_datasets) {
file_name <- paste("Data/CNV_Data/Full_CNV_metrics", i, ".csv", sep = "")
# Read the CSV file into a data.table
current_dataset <- fread(file_name)
current_dataset[, Mean_diff := (Mean_set - Mean_cntrl)]
new_name1 = paste('Mean_cntrl', i, sep = "")
new_name2 = paste('Mean_diff', i, sep = "")
rename_map <- c("Mean_cntrl" = new_name1, "Mean_diff" = new_name2)
# Rename columns in 'current_dataset' using the named vector
setnames(current_dataset, old = names(rename_map), new = rename_map)
# Select columns with their original names from 'current_dataset' and rename them
selected_columns <- current_dataset[random_rows, c("Sample", new_name1, new_name2), with = FALSE]
# Perform a merge based on Sample ID
used_first <- merge(used_first, selected_columns, by = "Sample", all = FALSE, suffixes = c("", i))
}
controls <- sample(1:num_datasets, 5)
dif_pairing_names <- unlist(lapply(controls, function(i) paste("Mean_diff", i, sep ="")))
violin_graph_long_data <- used_first %>%
pivot_longer(cols = all_of(dif_pairing_names),
names_to = "Variable",
values_to = "Value")
ggplot(violin_graph_long_data, aes(y = Value, x = Variable)) +
geom_violin(trim = FALSE, fill = "gray88")+
geom_boxplot(varwidth = T, alpha  = 0.25, outlier.colour = "red")+
labs(x = "Unique SoI / Control Pairings ", y = "Δ Log2 Copy Number",
title = "Distribution of the Set-of-Interest to Control Gene-Set \n  Copy Number Difference Across Various Pairings") +
theme(
legend.position = "none",
axis.title = element_text(size = 13, color = "black", face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.text.x = element_blank(),
panel.background = element_rect(fill = "white"),
legend.text = element_blank(),
plot.title = element_text(hjust = 0.6, size = 15),
panel.border = element_rect(fill = "transparent", color = 1, linewidth = 1),
panel.grid.major.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.minor.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
plot.title.position = "plot"
)
Fried_test_data <- used_first %>%
gather(key = "Pairing", value = "Difference", starts_with("Mean_cntrl")) %>%
mutate(Sample = as.factor(Sample), Pairing = as.factor(Pairing)) %>%
select(Sample, Pairing, Difference)
friedman_result <- coin::friedman_test(Difference ~ Pairing | Sample, data = Fried_test_data)
print(friedman_result)
Paired_wilc_table <- used_first %>%
dplyr::select(starts_with("Mean_diff")) %>%
mutate_all(as.numeric)
Contrast_table <- data.frame(Set = character(0), P_Value = numeric(0), Adj_P_Value = numeric(0), Significant = character(0))
# Loop over each control gene-sets
for (i in 1:num_datasets) {
set = paste('Mean_diff', i, sep = "")
Global_table <- Paired_wilc_table %>%
mutate(global = rowMeans(select(., -set), na.rm = TRUE)) %>%
select(set, global)
wlcx_paired_res = wilcox.test(Global_table[,get(set)], Global_table$global, paired = TRUE)
Corrected_Pval <- p.adjust(wlcx_paired_res$p.value, method = 'BH')
Significant_value <- if(Corrected_Pval < 0.05) "TRUE" else "FALSE"
Contrast_table <- rbind(Contrast_table, data.frame(Set = set, P_Value = wlcx_paired_res$p.value, Adj_P_Value = Corrected_Pval, Significant = Significant_value)) %>% arrange(desc(Adj_P_Value))
}
Contrast_agg_count_table <- Contrast_table %>% group_by(Significant) %>% summarise(count = n())
print(Contrast_agg_count_table)
graph_long_data <- used_first %>%
dplyr::select(starts_with("Mean_diff")) %>%
pivot_longer(cols = everything(),
names_to = "Variable",
values_to = "Value")
ggplot(graph_long_data, aes(y = Value, x = Variable)) +
geom_boxplot(varwidth = T, alpha  = 0.25, outlier.colour = "red")+
coord_cartesian(ylim = c(-0.25, 0.40)) +
scale_y_continuous() +
labs(x = "Unique SoI / Control Pairings ", y = "Δ Log2 Copy Number",
title = "Distribution of the Set-of-Interest to Control gene-set \n Copy Number Difference Across All Pairings") +
theme(
plot.title = element_text(hjust = 0.6, size = 15),
plot.title.position = "plot",
axis.title = element_text(size = 13, color = "black", face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
legend.text = element_blank(),
legend.position = "none",
panel.border = element_rect(fill = "transparent", color = 1, linewidth = 1),
panel.grid.major.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.minor.y = element_line(color = "black", linewidth = 0.1, linetype = 2),
panel.background = element_rect(fill = "white")
)
# Loop over each of the control datasets in the folder.
# For each control-set perform a two-sided paired Wilcoxon Signed Rank test with the SoI.
# Save the pvalue for each test in a dataframe.
paired_tests_list <- list()
for (i in 1:num_datasets) {
ctrl <- paste("Mean_cntrl", i, sep ="")
wlcx_paired_res <- wilcox.test(used_first$Mean_set, used_first[,get(ctrl)], paired = TRUE)
pair <- paste("Pair", i, sep ="_")
pair_frame = data.frame(Pairing = pair, Pvalue = as.numeric(wlcx_paired_res$p.value), Corrected_Pval = as.numeric(p.adjust(wlcx_paired_res$p.value, method = "BH", n = num_datasets)), Significant =  if(p.adjust(wlcx_paired_res$p.value, method = "BH", n = num_datasets) < 0.05) "TRUE" else "FALSE")
paired_tests_list[[i]] <- pair_frame
}
full_paired <- do.call(rbind, paired_tests_list) %>% arrange(desc(Pvalue))
full_paired_wilc <- full_paired %>% group_by(Significant) %>% summarise(count = n())
print(full_paired_wilc)
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "Log2 CN") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN (Log2)") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN (log2)") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN (log[2])") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN" %p% subsc("(n+4)") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = ("CN" %p% subsc("(n+4)")) +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "Log2 Expression") +
# scale_x_discrete(label = c("Control gene-set", "Set of Interest")) +
# scale_fill_hue(labels = c("Control gene-set", "Set of Interest"))+
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN" %p% supsc("(n+4)")) +
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
install.packages("reporter")
library(coin)
library(dplyr)
library(broom)
library(knitr)
library(coin)
library(data.table)
library(ggpubr)
library(rstatix)
library(ggplot2)
library(tidyverse)
library(jmuOutlier)
library(paletteer)
library(reporter)
install.packages("common")
library(dplyr)
library(broom)
library(knitr)
library(coin)
library(data.table)
library(ggpubr)
library(rstatix)
library(ggplot2)
library(tidyverse)
library(jmuOutlier)
library(paletteer)
library(reporter)
# Select 3 control gene-sets at random to compare their distributions with that of the SoI.
controls_names <- "Mean_set"
controls_names <- append(controls_names, unlist(lapply(controls, function(i) paste("Mean_cntrl", i, sep =""))))
# Pivot the data into a form that can be used by boxplot.
long_data <- used_first %>%
pivot_longer(cols = all_of(controls_names),
names_to = "Variable",
values_to = "Value")
ggplot(long_data, aes( y = Value, x = Variable)) +
geom_boxplot(outlier.colour = 2) +
stat_boxplot(geom = "errorbar") +
theme_minimal() +
labs(title = "Distribution of Mean Copy Number in the \n Set-of-Interest vs various Control-Sets",
y = "CN" %p% supsc("(n+4)")) +
theme(
legend.position = "None",
axis.title.y = element_text(size= 13),
plot.subtitle = element_text(hjust= 0.5),
axis.title.x = element_blank(),
axis.text.x = element_text(size = 11),
plot.title = element_text(hjust = 0.5,
size = 14),
panel.background = element_rect(fill = "#EDEDED"),
panel.grid.major.y = element_line(color = "black", linewidth = 0.25, linetype = 2),
panel.border = element_rect(fill = "transparent",
color = 1,
linewidth = 2))
