---
title: "RNA_Healthy_set"
output: html_document
date: "2024-01-26"
---




This Script is an R script which serves to clean, preprocess and then analyse the
GTEx RNA data that contains the healthy samples that are to be used in 
the Part one of the Analysis. 

The first part of the cleaning is to remove the samples (subjects)
which do not meet the criteria of being healthy. 
This is based on the DTHHRDY (Death Hardy Scale) measure from GTEx which is contained 
in the meta file that was also acquired. 
This measure is a value ranging from 0-4 and pertains to the state of the 
subject at the time of or before death. Values 0, 1, 2, and 3 are suitable for 
the analysis as they refer to cases involving sudden deaths (<24hrs) or ventilator cases that 
were not due to an underlying disease. A value of 4 is usually used
for deaths in which cancer was involved. 




```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Users/Dyll/Documents/Education/VU_UVA/Internship/Epigenetics/Janssen_Group-UMCUtrecht/Main_Project")
```


```{r}
# Load necessary libraries
library(data.table) # For data manipulation
# BiocManager::install("edgeR")
```


```{r}
# Reading the full RNA GTEx dataset
GTEx_Samp_df <- fread("Data/RNA_Data/GTEx_RNA/Raw_GTEx_RNA_Norm.csv")

# Reading the first RNA GTEx metadata dataset that contains the phenotype of the subject
GTEx_meta_df <- fread("Data/RNA_Data/GTEx_RNA/GTEx_RNA_Subject_meta.csv")

# Reading the second metadata dataset that contains the rest of the metadata for the subjects
GTEx_Annotations_df <- fread("Data/RNA_Data/GTEx_RNA/GTEx_Annotations.csv")
```
The current number of samples in the GTEx Dataset stands at 17385

1. Columns unhealthy samples 
```{r}
# Get the SUBJIDS that correspond to the samples to be used
Healthy_Subjects <- unique(GTEx_meta_df[GTEx_meta_df$DTHHRDY %in% c(1, 2, 3, 0),]$SUBJID)

# Get the column names from the full RNA GTEX dataset
cols <- colnames(GTEx_Samp_df)[4:length(colnames(GTEx_Samp_df))]

# Get the columns that should be dropped from the dataset
cols_to_drop <- cols[!substr(cols, 1, 10) %in% Healthy_Subjects]

# Create a new DF without the columns to be dropped
GTEx_Healthy_df <- GTEx_Samp_df[, !colnames(GTEx_Samp_df) %in% cols_to_drop, with = FALSE]


print(ncol(GTEx_Healthy_df))
```

The current number of samples in the GTEx Dataset is reduced to 10696 healthy samples

2. Remove the samples that are below the RIN (RNA Inegrity Number) Threshold of 6.0


```{r}
# Get the Sample IDs that correspond to the samples to be used
selected_samples <- GTEx_Annotations_df[GTEx_Annotations_df$SMRIN >= 6]$SAMPID
selected_samples <- c("Name", "Description", selected_samples)

# Create a DF with the columns to be used
GTEx_Viable_Healthy <- GTEx_Healthy_df[, colnames(GTEx_Healthy_df) %in% selected_samples, with = FALSE]

```



3. Remvoe teh 


